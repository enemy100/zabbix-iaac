---
- name: Atualizar o cache do DNF
  command: dnf clean all
  ignore_errors: yes

- name: Atualizar os metadados dos repositórios
  command: dnf makecache --setopt=module_platform_id=platform:el9
  ignore_errors: yes

- name: Instalar dependências básicas do sistema
  dnf:
    name:
      - gcc
      - python3-devel
      - pkg-config
      - zlib-devel
      - openssl-devel
      - rocky-logos-httpd
    state: present


- name: Baixar o arquivo de coleções do repositório
  get_url:
    url: "http://10.196.182.20/repo/ansible/zabbix-collection.tar"
    dest: "/tmp/zabbix-collection.tar"

- name: Criar diretório para extração das coleções
  file:
    path: "/tmp/zabbix-collections"
    state: directory
    mode: '0755'

- name: Extrair as coleções
  ansible.builtin.unarchive:
    src: "/tmp/zabbix-collection.tar"
    dest: "/tmp/zabbix-collections"
    remote_src: yes

- name: Instalar as coleções extraídas
  shell: |
     for collection in /tmp/zabbix-collections/*.tar.gz; do
       ansible-galaxy collection install $collection --offline
     done
  args:
     executable: /bin/bash

- name: Confirmar instalação das coleções
  command: ansible-galaxy collection list
  register: result

- name: Exibir coleções instaladas
  debug:
   msg: "{{ result.stdout_lines }}"


